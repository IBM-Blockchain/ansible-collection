

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Enable Hyperledger Fabric v2.x capabilities &mdash; Ansible Collection  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Creating a highly available Certificate Authority" href="haca.html" />
    <link rel="prev" title="Adding an administrator certificate" href="addadmincert.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ansible Collection
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installing.html">Installing the IBM Blockchain Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/building.html">Building a network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/joining.html">Joining a network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/deploying.html">Deploying a smart contract</a></li>
</ul>
<p class="caption"><span class="caption-text">Tasks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="addadmincert.html">Adding an administrator certificate</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Enable Hyperledger Fabric v2.x capabilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#before-you-start">Before you start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloning-the-repository">Cloning the repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="#editing-the-variable-file">Editing the variable file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enabling-v2-capability-for-the-system-channel">Enabling v2 Capability for the System Channel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enabling-v2-capability-for-specified-channels">Enabling v2 Capability for Specified Channels</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="haca.html">Creating a highly available Certificate Authority</a></li>
<li class="toctree-l1"><a class="reference internal" href="update-channel-parameters.html">Updating channel parameters</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roles.html">Roles</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible Collection</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Enable Hyperledger Fabric v2.x capabilities</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/IBM-Blockchain/ansible-collection/blob/master/docs/source/tasks/enable-fabricv2-capability.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="enable-hyperledger-fabric-v2-x-capabilities">
<h1>Enable Hyperledger Fabric v2.x capabilities<a class="headerlink" href="#enable-hyperledger-fabric-v2-x-capabilities" title="Permalink to this headline">¶</a></h1>
<p>Fabric v2 capability is distinct from Fabric v2.x binaries, and the most common scenario will be where the binaries on a network have been upgraded to v2.x, leaving the Capability of the channels at V1.x.  This playbook example can be used to upgrade firstly the system channel, then an array of named application channels.</p>
<p>Note that when an application channel has been upgraded to v2 capability it is incompatible with the Fabric v1.x chaincode lifecycle, and the new v2.* lifecycle must be used to upgrade or deploy new chaincodes (contracts).</p>
<p>v2 capability should only be enabled when all nodes on the network are running v2.x binaries.</p>
<div class="section" id="before-you-start">
<h2>Before you start<a class="headerlink" href="#before-you-start" title="Permalink to this headline">¶</a></h2>
<p>This task guide assumes that you have installed Ansible and the IBM Blockchain Platform collection for Ansible, and are familiar with how to use these technologies.</p>
</div>
<div class="section" id="cloning-the-repository">
<h2>Cloning the repository<a class="headerlink" href="#cloning-the-repository" title="Permalink to this headline">¶</a></h2>
<p>This task guide uses a set of example playbooks which are stored in a GitHub repository. You must clone this GitHub repository in order to run the playbooks locally:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/IBM-Blockchain/ansible-collection.git
</pre></div>
</div>
</div></blockquote>
<p>After cloning the GitHub repository, you must change into the examples directory for this task guide:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ansible-collection/examples/enable-fabricv2-capability
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="editing-the-variable-file">
<h2>Editing the variable file<a class="headerlink" href="#editing-the-variable-file" title="Permalink to this headline">¶</a></h2>
<p>You need to edit the variable file <code class="docutils literal notranslate"><span class="pre">vars.yml</span></code>. This file is used to pass information about your network into the example Ansible playbooks.</p>
<p>The first set of values that you must set depend on whether the organization is using the IBM Blockchain Platform on IBM Cloud, or the IBM Blockchain Platform software:</p>
<ul class="simple">
<li><p>If the organization is using IBM Blockchain Platform on IBM Cloud:</p>
<ol class="arabic simple">
<li><p>Create service credentials for the IBM Blockchain Platform service instance, if they have not been created already.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_endpoint</span></code> to the value of <code class="docutils literal notranslate"><span class="pre">api_endpoint</span></code> specified in the service credentials.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_authtype</span></code> to <code class="docutils literal notranslate"><span class="pre">ibmcloud</span></code>.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_key</span></code> to the value of <code class="docutils literal notranslate"><span class="pre">api_key</span></code> specified in the service credentials.</p></li>
<li><p>Note that you do not need to specify a value for <code class="docutils literal notranslate"><span class="pre">api_secret</span></code>.</p></li>
</ol>
</li>
<li><p>If the organization is using IBM Blockchain Platform software:</p>
<ol class="arabic simple">
<li><p>Determine the URL of your IBM Blockchain Platform console.</p></li>
<li><p>Determine the API key and secret you use to access your IBM Blockchain Platform console. You can also use a username and password instead of an API key and secret.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_endpoint</span></code> to the URL of your IBM Blockchain Platform console.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_authtype</span></code> to <code class="docutils literal notranslate"><span class="pre">basic</span></code>.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_key</span></code> to your API key or username.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_secret</span></code> to your API secret or password.</p></li>
</ol>
</li>
</ul>
<p>The second set of values must always be set:</p>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">ordering_service_name</span></code> to the name of the ordering service, for example <code class="docutils literal notranslate"><span class="pre">Ordering</span> <span class="pre">Service</span></code>.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">organization_name</span></code> to the name of the organization.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">organization_msp_id</span></code> to the MSP ID of the organization.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">organization_admin_identity</span></code> to the path of a JSON identity file containing the identity of the organization administrator.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">ordering_service_admin_identity</span></code> to the path to a JSON identity file containing the identity of an ordering service administrator.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">ordering_service_admin_msp_id</span></code> to the MSP ID of the ordering service administrator.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">channel_names</span></code> to an array of channel names that need to have Fabric v2 capability enabled. Do not include the system channel name in this value.</p></li>
</ul>
</div>
<div class="section" id="enabling-v2-capability-for-the-system-channel">
<h2>Enabling v2 Capability for the System Channel<a class="headerlink" href="#enabling-v2-capability-for-the-system-channel" title="Permalink to this headline">¶</a></h2>
<p>The first task is to enable v2 capability on the system channel of the Orderer.
Note that any new channels created after updating the System Channel will have v2 capability enabled by default, but readers are encouraged to verify that all the capabilities are enabled for the new channels.</p>
<p>Review the example playbook <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/master/examples/enable-fabricv2-capability/01-enable-fabricv2-systemchannel.yml">01-enable-fabricv2-systemchannel.yml</a>.</p>
<p>Ensure that the JSON identity files specified in the <code class="docutils literal notranslate"><span class="pre">vars.yml</span></code> file have been copied to the working directory.</p>
<p>Run the playbook as follows:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 01-enable-fabricv2-systemchannel.yml
</pre></div>
</div>
</div></blockquote>
<p>Ensure that the example playbook completed successfully by examining the <code class="docutils literal notranslate"><span class="pre">PLAY</span> <span class="pre">RECAP</span></code> section in the output from Ansible.</p>
</div>
<div class="section" id="enabling-v2-capability-for-specified-channels">
<h2>Enabling v2 Capability for Specified Channels<a class="headerlink" href="#enabling-v2-capability-for-specified-channels" title="Permalink to this headline">¶</a></h2>
<p>The second step in this task is to enable v2 capability for the application channels.  Application channels do not have to be v2 enabled immediately after the system channel, channels can continue to run with V1.x capability if required.</p>
<p>Note that when you have enabled v2 Capability on a channel you are commited to using the new v2 Chaincode Lifecycle on that channel.</p>
<p>v2 capability requires that a <em>Channel Application Endorsement Policy</em> be added to the channel.  This playbook uses an example policy <code class="docutils literal notranslate"><span class="pre">endorsement-policy.json</span></code>.
v2 capability enables a default majority Lifecycle Endorsement Policy, but if a different policy is required, this playbook can be modified to include such a policy at the time v2 capability is enabled.</p>
<p>In this example playbook both the Ordering Service Administrator identity, and the Organisation Administrator identity are used to sign the modified channel configuration but in other scenarios these identities for signing may be different.</p>
<p>Review the example playbook <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/master/examples/enable-fabricv2-capability/02-enable-fabricv2-channels.yml">02-enable-fabricv2-channels.yml</a>.</p>
<p>When reviewing the playbook you will note that an additional playbook is used on a loop across the array of channels listed in the variables file  <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/master/examples/enable-fabricv2-capability/tasks/02-enable-fabricv2-channel.yml">02-enable-fabricv2-channel.yml</a>.</p>
<p>Run the playbook as follows:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 02-enable-fabricv2-channels.yml
</pre></div>
</div>
</div></blockquote>
<p>Ensure that the example playbook completed successfully by examining the <code class="docutils literal notranslate"><span class="pre">PLAY</span> <span class="pre">RECAP</span></code> section in the output from Ansible.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="haca.html" class="btn btn-neutral float-right" title="Creating a highly available Certificate Authority" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="addadmincert.html" class="btn btn-neutral float-left" title="Adding an administrator certificate" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright IBM Corporation 2020.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>