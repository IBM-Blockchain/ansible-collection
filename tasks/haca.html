<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating a highly available Certificate Authority &mdash; Ansible Collection  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Creating an Intermediate Certificate Authority" href="intermediateCA.html" />
    <link rel="prev" title="Enable Hyperledger Fabric v2.x capabilities" href="enable-fabricv2-capability.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Ansible Collection
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrating-v12-v2.html">Migrating from v1.2 to version 2</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/oss-installing.html">Installing Open Source Hyperledger Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/hlfsupport-installing.html">Installing IBM Support for Hyperledger Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installing.html">Installing the IBM Blockchain Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/building.html">Building a network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/joining.html">Joining a network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/deploying.html">Deploying a smart contract</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tasks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="addadmincert.html">Adding an administrator certificate</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable-fabricv2-capability.html">Enable Hyperledger Fabric v2.x capabilities</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating a highly available Certificate Authority</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#before-you-start">Before you start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloning-the-repository">Cloning the repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="#editing-the-variable-file">Editing the variable file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-certificate-authority">Creating the certificate authority</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="intermediateCA.html">Creating an Intermediate Certificate Authority</a></li>
<li class="toctree-l1"><a class="reference internal" href="update-channel-parameters.html">Updating channel parameters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roles.html">Roles</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Getting support</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible Collection</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Creating a highly available Certificate Authority</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/docs/source/tasks/haca.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-a-highly-available-certificate-authority">
<h1>Creating a highly available Certificate Authority<a class="headerlink" href="#creating-a-highly-available-certificate-authority" title="Link to this heading"></a></h1>
<p>The default certificate authority in IBM Blockchain Platform is a single replica with an integrated SQLite database, however it is possible to configure the certificate authority to have an external PostgresSQL database and have multiple replicas of the certificate authority.</p>
<p>The IBM Blockchain Platform documentation describes some limitations with the creation of replicas, including the restriction that an existing certificate authority with an integrated SQLite database cannot be upgraded to use a PostgresSQL database.  Consequently, the playbook for this task checks for the existence of the named certificate authority and fails if it already exists.</p>
<section id="before-you-start">
<h2>Before you start<a class="headerlink" href="#before-you-start" title="Link to this heading"></a></h2>
<p>This task guide assumes that you have installed Ansible and the IBM Blockchain Platform collection for Ansible, and are familiar with how to use these technologies.</p>
<p>This task guide also assumes that you have created a PostgresSQL database and that you have the connection details available.</p>
</section>
<section id="cloning-the-repository">
<h2>Cloning the repository<a class="headerlink" href="#cloning-the-repository" title="Link to this heading"></a></h2>
<p>This task guide uses a set of example playbooks which are stored in a GitHub repository. You must clone this GitHub repository in order to run the playbooks locally:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/IBM-Blockchain/ansible-collection.git
</pre></div>
</div>
</div></blockquote>
<p>After cloning the GitHub repository, you must change into the examples directory for this task guide:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ansible-collection/examples/create-ha-ca
</pre></div>
</div>
</div></blockquote>
</section>
<section id="editing-the-variable-file">
<h2>Editing the variable file<a class="headerlink" href="#editing-the-variable-file" title="Link to this heading"></a></h2>
<p>You need to edit the variable file <code class="docutils literal notranslate"><span class="pre">vars.yml</span></code>. This file is used to pass information about your network into the example Ansible playbook.</p>
<p>The first set of values that you must set depend on whether the organization is using the IBM Blockchain Platform on IBM Cloud, or the IBM Blockchain Platform software:</p>
<ul class="simple">
<li><p>If the organization is using IBM Blockchain Platform on IBM Cloud:</p>
<ol class="arabic simple">
<li><p>Create service credentials for the IBM Blockchain Platform service instance, if they have not been created already.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_endpoint</span></code> to the value of <code class="docutils literal notranslate"><span class="pre">api_endpoint</span></code> specified in the service credentials.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_authtype</span></code> to <code class="docutils literal notranslate"><span class="pre">ibmcloud</span></code>.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_key</span></code> to the value of <code class="docutils literal notranslate"><span class="pre">api_key</span></code> specified in the service credentials.</p></li>
<li><p>Note that you do not need to specify a value for <code class="docutils literal notranslate"><span class="pre">api_secret</span></code>.</p></li>
</ol>
</li>
<li><p>If the organization is using IBM Blockchain Platform software:</p>
<ol class="arabic simple">
<li><p>Determine the URL of your IBM Blockchain Platform console.</p></li>
<li><p>Determine the API key and secret you use to access your IBM Blockchain Platform console. You can also use a username and password instead of an API key and secret.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_endpoint</span></code> to the URL of your IBM Blockchain Platform console.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_authtype</span></code> to <code class="docutils literal notranslate"><span class="pre">basic</span></code>.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_key</span></code> to your API key or username.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_secret</span></code> to your API secret or password.</p></li>
</ol>
</li>
</ul>
<p>The remaining values must always be set:</p>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">ha_ca_name</span></code> to the name of the new certificate authority, for example <code class="docutils literal notranslate"><span class="pre">HAOrg1</span> <span class="pre">CA</span></code>.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">ca_admin_identity</span></code> to the name of the CA administrator enroll ID.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">ca_admin_pass</span></code> to the CA administrator enroll secret.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">ca_admin_type</span></code> to <code class="docutils literal notranslate"><span class="pre">client</span></code> if you are <strong>not</strong> using NodeOU support or <code class="docutils literal notranslate"><span class="pre">admin</span></code> if you <strong>are</strong> using NodeOU support.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">db_datasource</span></code> to the connection details for your PostgresSQL database, for example:</p></li>
</ul>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">host=mypostgressql.example.com</span> <span class="pre">port=999</span> <span class="pre">user=myUsername</span> <span class="pre">password=myPassword</span> <span class="pre">dbname=mydb</span> <span class="pre">sslmode=verify-full</span></code></p>
</div></blockquote>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">db_certfile1</span></code> to the Base64 encoded value of the certificate for the PostgresSQL database.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">ca_replicas</span></code> to the number of replicas of the ca that you require.</p></li>
</ul>
</section>
<section id="creating-the-certificate-authority">
<h2>Creating the certificate authority<a class="headerlink" href="#creating-the-certificate-authority" title="Link to this heading"></a></h2>
<p>Review the example playbook <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/examples/haca/create-ha-ca.yml">create-ha-ca.yml</a>, then run it as follows:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook create-ha-ca.yml
</pre></div>
</div>
</div></blockquote>
<p>Ensure that the example playbook completed successfully by examining the <code class="docutils literal notranslate"><span class="pre">PLAY</span> <span class="pre">RECAP</span></code> section in the output from Ansible.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="enable-fabricv2-capability.html" class="btn btn-neutral float-left" title="Enable Hyperledger Fabric v2.x capabilities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="intermediateCA.html" class="btn btn-neutral float-right" title="Creating an Intermediate Certificate Authority" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright IBM Corporation 2020.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>