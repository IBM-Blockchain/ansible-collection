<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Building a network &mdash; Ansible Collection  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Joining a network" href="joining.html" />
    <link rel="prev" title="Installing the IBM Blockchain Platform" href="installing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Ansible Collection
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrating-v12-v2.html">Migrating from v1.2 to version 2</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="oss-installing.html">Installing Open Source Hyperledger Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="hlfsupport-installing.html">Installing IBM Support for Hyperledger Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing the IBM Blockchain Platform</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Building a network</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#before-you-start">Before you start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloning-the-repository">Cloning the repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="#editing-the-variable-files">Editing the variable files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-the-network">Building the network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exploring-the-network">Exploring the network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exploring-the-playbooks">Exploring the playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#destroying-the-network">Destroying the network</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="joining.html">Joining a network</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploying.html">Deploying a smart contract</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tasks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tasks/addadmincert.html">Adding an administrator certificate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks/enable-fabricv2-capability.html">Enable Hyperledger Fabric v2.x capabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks/haca.html">Creating a highly available Certificate Authority</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks/intermediateCA.html">Creating an Intermediate Certificate Authority</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks/update-channel-parameters.html">Updating channel parameters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roles.html">Roles</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Getting support</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible Collection</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Building a network</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/docs/source/tutorials/building.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="building-a-network">
<h1>Building a network<a class="headerlink" href="#building-a-network" title="Permalink to this heading"></a></h1>
<p>This tutorial will demonstrate how to use the IBM Blockchain Platform collection for Ansible to automate the process of building a new Hyperledger Fabric network.</p>
<p>In this tutorial, you will use the IBM Blockchain Platform collection for Ansible to build a Hyperledger Fabric network with two organizations. One organization “Ordering Org” will be the ordering organization, and that organization will run the ordering service. The other organization “Org1” will be an endorsing organization, and that organization will run a peer. You will also create a channel, and join the endorsing organizations peer into that channel.</p>
<p>For this tutorial, you can use the IBM Blockchain Platform on IBM Cloud, or the IBM Blockchain Platform software running in a Red Hat OpenShift or Kubernetes cluster.</p>
<section id="before-you-start">
<h2>Before you start<a class="headerlink" href="#before-you-start" title="Permalink to this heading"></a></h2>
<p>Ensure that you have installed all of the pre-requisite software described in <a class="reference external" href="../installation.html">Installation</a>.</p>
<p>You must have access to an existing IBM Blockchain Plaform instance, either on IBM Cloud, or using the IBM Blockchain Platform software running in a Red Hat OpenShift or Kubernetes cluster.</p>
<p>If you wish, you can deploy the components for each organization into a separate IBM Blockchain Platform instance. If you choose to do this, then there are additional steps that you must follow which will be described below.</p>
</section>
<section id="cloning-the-repository">
<h2>Cloning the repository<a class="headerlink" href="#cloning-the-repository" title="Permalink to this heading"></a></h2>
<p>The playbooks for this tutorial are stored in a GitHub repository. You must clone this GitHub repository in order to run the playbooks locally:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/IBM-Blockchain/ansible-collection.git
</pre></div>
</div>
</div></blockquote>
<p>After cloning the GitHub repository, you must change into the tutorial directory:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ansible-collection/tutorial
</pre></div>
</div>
</div></blockquote>
</section>
<section id="editing-the-variable-files">
<h2>Editing the variable files<a class="headerlink" href="#editing-the-variable-files" title="Permalink to this heading"></a></h2>
<p>Variable files are used to store variables that are used across multiple Ansible playbooks. Each organization has their own variable file, and you must edit these files to specify the connection details for the IBM Blockchain Platform instance for that organization.</p>
<p>Edit the variable files <cite>ordering-org-vars.yml</cite> (for Ordering Org) and <cite>org1-vars.yml</cite> (for Org1). The values you set depend on whether the organization is using the IBM Blockchain Platform on IBM Cloud, or the IBM Blockchain Platform software:</p>
<ul class="simple">
<li><p>If the organization is using IBM Blockchain Platform on IBM Cloud:</p>
<ol class="arabic simple">
<li><p>Create service credentials for the IBM Blockchain Platform service instance, if they have not been created already.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_endpoint</span></code> to the value of <code class="docutils literal notranslate"><span class="pre">api_endpoint</span></code> specified in the service credentials.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_authtype</span></code> to <code class="docutils literal notranslate"><span class="pre">ibmcloud</span></code>.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_key</span></code> to the value of <code class="docutils literal notranslate"><span class="pre">api_key</span></code> specified in the service credentials.</p></li>
<li><p>Note that you do not need to specify a value for <code class="docutils literal notranslate"><span class="pre">api_secret</span></code>.</p></li>
</ol>
</li>
<li><p>If the organization is using IBM Blockchain Platform software:</p>
<ol class="arabic simple">
<li><p>Determine the URL of your IBM Blockchain Platform console.</p></li>
<li><p>Determine the API key and secret you use to access your IBM Blockchain Platform console. You can also use a username and password instead of an API key and secret.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_endpoint</span></code> to the URL of your IBM Blockchain Platform console.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_authtype</span></code> to <code class="docutils literal notranslate"><span class="pre">basic</span></code>.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_key</span></code> to your API key or username.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">api_secret</span></code> to your API secret or password.</p></li>
</ol>
</li>
</ul>
<p>There is also a common variables file, <cite>common-vars.yml</cite>. You do not need to edit this variable file. This file contains variables that are used by multiple organizations, for example the name of the channel that will be created, and the name of the smart contract that will be deployed.</p>
<p>The variable files are specified in the Ansible playbooks using the <code class="docutils literal notranslate"><span class="pre">vars_files</span></code> argument for each play. When the Ansible playbooks are run, Ansible loads all variables from all variable files specified and makes them available for use in that play.</p>
<p>Finally, all of the organization specific variable files contain a <code class="docutils literal notranslate"><span class="pre">wait_timeout</span></code> variable, with the default set to <code class="docutils literal notranslate"><span class="pre">600</span></code> (seconds). This is the amount of time in seconds to wait for certificate authorities, peers, and ordering services to start. Depending on your environment, you may need to increase this timeout, for example if it takes a long time to provision the persistent volumes for each component.</p>
</section>
<section id="building-the-network">
<h2>Building the network<a class="headerlink" href="#building-the-network" title="Permalink to this heading"></a></h2>
<p>There are multiple Ansible playbooks used in this tutorial. Each Ansible playbook performs a part of the set of tasks required to build the network. Each of the Ansible playbooks is run as either the ordering organization “Ordering Org”, or the endorsing organization “Org1”.</p>
<p>The contents of these playbooks are explored at the end of this tutorial. For now, a script <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/build_network.sh">build_network.sh</a> has been provided which runs these Ansible playbooks in order for you.</p>
<p>Note that if each organization has their own IBM Blockchain Platform instance, you must run a different command. This is required as organization and ordering service information must be exported and then imported into the other IBM Blockchain Platform instance.</p>
<p>If you have installed the collection using Ansible Galaxy, or from source, then run the script as follows:</p>
<ul>
<li><p>Both organizations use the same IBM Blockchain Platform instance:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./build_network.sh build
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Each organization has their own IBM Blockchain Platform instance:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./build_network.sh -i build
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>If you have installed the collection by building a Docker image, then run the script as follows:</p>
<ul>
<li><p>Both organizations use the same IBM Blockchain Platform instance:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker run --rm -u $(id -u) -v &quot;$PWD:/tutorial&quot; ibmcom/ibp-ansible /tutorial/build_network.sh build
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Each organization has their own IBM Blockchain Platform instance:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker run --rm -u $(id -u) -v &quot;$PWD:/tutorial&quot; ibmcom/ibp-ansible /tutorial/build_network.sh -i build
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>After the script has finished, you should examine the output of the script to check that no errors have occurred whilst running the Ansible playbooks. After each Ansible playbook runs, Ansible outputs a <code class="docutils literal notranslate"><span class="pre">PLAY</span> <span class="pre">RECAP</span></code> section that details how many tasks have been executed, and how many of those tasks have failed.</p>
</section>
<section id="exploring-the-network">
<h2>Exploring the network<a class="headerlink" href="#exploring-the-network" title="Permalink to this heading"></a></h2>
<p>The Ansible playbooks that you just ran created the following components:</p>
<ul class="simple">
<li><p>An ordering organization named <cite>Ordering Org</cite>, with a certificate authority named <cite>Ordering Org CA</cite>, and an ordering service named <cite>Ordering Service</cite>.</p></li>
<li><p>An endorsing organization named <cite>Org1</cite>, with a certificate authority named <cite>Org1 CA</cite>, and a peer named <cite>Org1 Peer</cite>.</p></li>
<li><p>A single channel called <cite>mychannel</cite>, with the endorsing organization <cite>Org1</cite> as the only member, and the peer <cite>Org1 Peer</cite> as the only anchor peer.</p></li>
</ul>
<p>The Ansible playbooks also registered and enrolled several identities - digital certificate and private key pairs - that act as the administrator for each organization. These identities are created on disk, as JSON files in the same directory as the playbooks, and you must store these identities somewhere.</p>
<p>The identities created are:</p>
<ul>
<li><p><cite>Ordering Org CA Admin.json</cite></p>
<div class="line-block">
<div class="line">This is the identity of the administrator for the certificate authority <cite>Ordering Org CA</cite>. You can use this identity to register new users, and revoke existing users.</div>
</div>
</li>
<li><p><cite>Ordering Org Admin.json</cite></p>
<div class="line-block">
<div class="line">This is the identity of the administrator for the ordering organization <cite>Ordering Org</cite>, and the ordering service <cite>Ordering Service</cite>. You can use this identity to manage the organization and the ordering service.</div>
</div>
</li>
<li><p><cite>Org1 CA Admin.json</cite></p>
<div class="line-block">
<div class="line">This is the identity of the administrator for the certificate authority <cite>Org1 CA</cite>. You can use this identity to register new users, and revoke existing users.</div>
</div>
</li>
<li><p><cite>Org1 Admin.json</cite></p>
<div class="line-block">
<div class="line">This is the identity of the administrator for the endorsing organization <cite>Org1</cite>, and the peer <cite>Org1 Peer</cite>. You can use this identity to manage the organization and the peer.</div>
</div>
</li>
</ul>
<p>If you log in to the IBM Blockchain Platform console for each organization using a web browser, you should find that these components are now displayed in the list of nodes.</p>
<p>You can also import the JSON files containing the identities listed above into the IBM Blockchain Platform console wallet. Once all of the identities have been imported, you can associate each component with the appropriate identity. This will allow you to manage and view those components using the IBM Blockchain Platform console.</p>
</section>
<section id="exploring-the-playbooks">
<h2>Exploring the playbooks<a class="headerlink" href="#exploring-the-playbooks" title="Permalink to this heading"></a></h2>
<p>When you ran the script <cite>build_network.sh</cite>, you ran multiple Ansible playbooks. Each Ansible playbook performed a different part of building the network. This section will explain which organization ran each Ansible playbook, and what each of the playbooks did.</p>
<p>Firstly, each of these Ansible playbooks require information that allows them to connect to the IBM Blockchain Platform instance, so they can interact with the IBM Blockchain Platform APIs. Before you ran the Ansible playbooks, you edited the variable files <cite>ordering-org-vars.yml</cite> and <cite>org1-vars.yml</cite>. These variable files are specified in the Ansible playbooks using the <code class="docutils literal notranslate"><span class="pre">vars_files</span></code> argument for each play, for example:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- name: Add the organization to the consortium
  hosts: localhost
  vars_files:
    - common-vars.yml
    - ordering-org-vars.yml
</pre></div>
</div>
</div></blockquote>
<p>When the Ansible playbooks are run, Ansible loads all variables from all variable files specified and makes them accessible for use in tasks within the Ansible playbook being run. You will see these variables are referenced when calling the Ansible modules in this collection, for example:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ibm.blockchain_platform.channel_block:
  api_endpoint: &quot;{{ api_endpoint }}&quot;
  api_authtype: &quot;{{ api_authtype }}&quot;
  api_key: &quot;{{ api_key }}&quot;
  api_secret: &quot;{{ api_secret | default(omit) }}&quot;
</pre></div>
</div>
</div></blockquote>
<p>Note that this tutorial instructs you to place secrets (API keys, API secrets, passwords, etc) in plain text in these variable files. It is possible to encrypt these variables using built-in Ansible functionality, for example <a class="reference external" href="https://docs.ansible.com/ansible/latest/user_guide/vault.html">Ansible Vault</a> or Ansible lookup plugins such as <a class="reference external" href="https://docs.ansible.com/ansible/latest/plugins/lookup/hashi_vault.html">hashi_vault</a>.</p>
<p>Here are the Ansible playbooks that were executed by the script above:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/01-create-ordering-organization-components.yml">01-create-ordering-organization-components.yml</a></p>
<div class="line-block">
<div class="line">Organization: Ordering Org</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 01-create-ordering-organization-components.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook creates the components for the ordering organization <cite>Ordering Org</cite>. It makes use of the Ansible role <a class="reference external" href="../roles/ordering_organization.html">ordering_organization</a> to set up the certificate authority, organization (MSP) and ordering service for this organization, along with the administrator identities for this organization.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/02-create-endorsing-organization-components.yml">02-create-endorsing-organization-components.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org1</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 02-create-endorsing-organization-components.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook creates the components for the endorsing organization <cite>Org1</cite>. It makes use of the Ansible role <a class="reference external" href="../roles/endorsing_organization.html">endorsing_organization</a> to set up the certificate authority, organization (MSP) and peer for this organization, along with the administrator identities for this organization.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/03-export-organization.yml">03-export-organization.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org1</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 03-export-organization.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook uses the Ansible module <a class="reference external" href="../modules/organization_info.html">organization_info</a> to export the organization <cite>Org1</cite> to a file. This is so that <cite>Org1</cite> can pass this file to the ordering organization <cite>Ordering Org</cite>. <cite>Ordering Org</cite> can then import this file into their IBM Blockchain Platform console, so they can add <cite>Org1</cite> into the consortium for the ordering service.</div>
</div>
<div class="line-block">
<div class="line">Note: this playbook only needs to be executed when the organizations <cite>Ordering Org</cite> and <cite>Org1</cite> are using separate IBM Blockchain Platform instances. If they are using the same instances, then this information is already available to both organizations.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/04-import-organization.yml">04-import-organization.yml</a></p>
<div class="line-block">
<div class="line">Organization: Ordering Org</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 04-import-organization.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook uses the Ansible module <a class="reference external" href="../modules/external_organization.html">external_organization</a> to import the organization <cite>Org1</cite> from a file. This file was passed to <cite>Ordering Org</cite> by <cite>Org1</cite>, so that <cite>Ordering Org</cite> could add <cite>Org1</cite> into the consortium for the ordering service.</div>
</div>
<div class="line-block">
<div class="line">Note: this playbook only needs to be executed when the organizations <cite>Ordering Org</cite> and <cite>Org1</cite> are using separate IBM Blockchain Platform instances. If they are using the same instances, then this information is already available to both organizations.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/05-enable-capabilities.yml">05-enable-capabitilies.yml</a></p>
<div class="line-block">
<div class="line">Organization: Ordering Org</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 05-enable-capabilities.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook enables Fabric v2.x capabilities on the ordering service. It uses the Ansible modules <a class="reference external" href="../modules/channel_config.html">channel_config</a> and <a class="reference external" href="../modules/channel_capabilities.html">channel_capabilities</a> to update the system channel configuration.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/06-add-organization-to-consortium.yml">06-add-organization-to-consortium.yml</a></p>
<div class="line-block">
<div class="line">Organization: Ordering Org</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 06-add-organization-to-consortium.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook adds the organization <cite>Org1</cite> into the consortium for the ordering service. It uses the Ansible modules <a class="reference external" href="../modules/channel_config.html">channel_config</a> and <a class="reference external" href="../modules/consortium_member.html">consortium_member</a> to update the system channel configuration, which contains the list of consortium members.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/07-export-ordering-service.yml">07-export-ordering-service.yml</a></p>
<div class="line-block">
<div class="line">Organization: Ordering Org</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 07-export-ordering-service.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook uses the Ansible module <a class="reference external" href="../modules/ordering_service_info.html">ordering_service_info</a> to export the ordering service to a file. This is so that <cite>Ordering Org</cite> can pass this file to the organization <cite>Org1</cite>. <cite>Org1</cite> can then import this file into their IBM Blockchain Platform console, so they can start to create channels on the ordering service.</div>
</div>
<div class="line-block">
<div class="line">Note: this playbook only needs to be executed when the organizations <cite>Ordering Org</cite> and <cite>Org1</cite> are using separate IBM Blockchain Platform instances. If they are using the same instances, then this information is already available to both organizations.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/08-import-ordering-service.yml">08-import-ordering-service.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org1</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 08-import-ordering-service.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook uses the Ansible module <a class="reference external" href="../modules/external_ordering_service.html">external_ordering_service</a> to import the ordering service from a file. This file was passed to <cite>Org1</cite> by <cite>Ordering Org</cite>, so that <cite>Org1</cite> could start to create channels on the ordering service.</div>
</div>
<div class="line-block">
<div class="line">Note: this playbook only needs to be executed when the organizations <cite>Ordering Org</cite> and <cite>Org1</cite> are using separate IBM Blockchain Platform instances. If they are using the same instances, then this information is already available to both organizations.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/09-create-channel.yml">09-create-channel.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org1</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 09-create-channel.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook creates a channel called <cite>mychannel</cite> on the ordering service. The channel contains a single organization, <cite>Org1</cite>. The policies for this channel are supplied in policy files:</div>
</div>
<ul class="simple">
<li><p><cite>Admins</cite>: <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/09-admins-policy.json">09-admins-policy.json</a></p></li>
<li><p><cite>Readers</cite>: <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/09-readers-policy.json">09-readers-policy.json</a></p></li>
<li><p><cite>Writers</cite>: <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/09-writers-policy.json">09-writers-policy.json</a></p></li>
<li><p><cite>Endorsement</cite>: <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/09-endorsement-policy.json">09-endorsement-policy.json</a></p></li>
<li><p><cite>LifecycleEndorsement</cite>: <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/09-lifecycle-endorsement-policy.json">09-lifecycle-endorsement-policy.json</a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">The Ansible module <a class="reference external" href="../modules/channel_config.html">channel_config</a> is used to create the channel.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/10-join-peer-to-channel.yml">10-join-peer-to-channel.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org1</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 10-join-peer-to-channel.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook uses the Ansible module <a class="reference external" href="../modules/channel_block.html">channel_block</a> to fetch the genesis block for the channel, before using the Ansible module <a class="reference external" href="../modules/peer_channel.html">peer_channel</a> to join the peer <cite>Org1 Peer</cite> to the channel.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/11-add-anchor-peer-to-channel.yml">11-add-anchor-peer-to-channel.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org1</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 11-add-anchor-peer-to-channel.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook updates the organization (MSP) definition for <cite>Org1</cite> in the channel <cite>mychannel</cite> to specify that the peer <cite>Org1 Peer</cite> is an anchor peer for the channel. It uses the Ansible modules <a class="reference external" href="../modules/channel_config.html">channel_config</a> and <a class="reference external" href="../modules/channel_member.html">channel_member</a> to update the channel configuration.</div>
</div>
</li>
</ul>
<p>Finally, there are also two Ansible playbooks that can be used to destroy the network components for <cite>Ordering Org</cite> and <cite>Org1</cite>. They are:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/97-delete-endorsing-organization-components.yml">97-delete-endorsing-organization-components.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org1</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 97-delete-endorsing-organization-components.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook deletes the components for the endorsing organization <cite>Org1</cite>. It makes use of the Ansible role <a class="reference external" href="../roles/endorsing_organization.html">endorsing_organization</a> to remove the certificate authority, organization (MSP) and peer for this organization, along with the administrator identities for this organization.</div>
</div>
<div class="line-block">
<div class="line">Note: this is the same Ansible role that is used to create the components, but the <code class="docutils literal notranslate"><span class="pre">state:</span> <span class="pre">absent</span></code> variable tells this role that we do not want these components to exist.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/99-delete-ordering-organization-components.yml">99-delete-ordering-organization-components.yml</a></p>
<div class="line-block">
<div class="line">Organization: Ordering Org</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 99-delete-ordering-organization-components.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook deletes the components for the ordering organization <cite>Ordering Org</cite>. It makes use of the Ansible role <a class="reference external" href="../roles/ordering_organization.html">ordering_organization</a> to remove up the certificate authority, organization (MSP) and ordering service for this organization, along with the administrator identities for this organization.</div>
</div>
<div class="line-block">
<div class="line">Note: this is the same Ansible role that is used to create the components, but the <code class="docutils literal notranslate"><span class="pre">state:</span> <span class="pre">absent</span></code> variable tells this role that we do not want these components to exist.</div>
</div>
</li>
</ul>
</section>
<section id="destroying-the-network">
<h2>Destroying the network<a class="headerlink" href="#destroying-the-network" title="Permalink to this heading"></a></h2>
<p>If you wish to destroy the network in order to remove all of the components created by this tutorial, then you can run additional Ansible playbooks to do this for you. You can use the <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/build_network.sh">build_network.sh</a> script again to run these Ansible playbooks.</p>
<p>Note that if each organization has their own IBM Blockchain Platform instance, you must run a different command.</p>
<p>If you have installed the collection using Ansible Galaxy, or from source, then run the script as follows:</p>
<ul>
<li><p>Both organizations use the same IBM Blockchain Platform instance:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./build_network.sh destroy
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Each organization has their own IBM Blockchain Platform instance:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./build_network.sh -i destroy
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>If you have installed the collection by building a Docker image, then run the script as follows:</p>
<ul>
<li><p>Both organizations use the same IBM Blockchain Platform instance:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker run --rm -u $(id -u) -v &quot;$PWD:/tutorial&quot; ibmcom/ibp-ansible /tutorial/build_network.sh destroy
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Each organization has their own IBM Blockchain Platform instance:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker run --rm -u $(id -u) -v &quot;$PWD:/tutorial&quot; ibmcom/ibp-ansible /tutorial/build_network.sh -i destroy
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>After the script has finished, you should examine the output of the script to check that no errors have occurred whilst running the Ansible playbooks. After each Ansible playbook runs, Ansible outputs a <code class="docutils literal notranslate"><span class="pre">PLAY</span> <span class="pre">RECAP</span></code> section that details how many tasks have been executed, and how many of those tasks have failed.</p>
<p>Finally, if you have imported any identities into the IBM Blockchain Platform console wallet that have been created by these Ansible playbooks, then these identities will still remain in the wallet even after the network has been destroyed. Ansible cannot remove these identities from the wallet. You must remove these identities yourself using the IBM Blockchain Platform console.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installing.html" class="btn btn-neutral float-left" title="Installing the IBM Blockchain Platform" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="joining.html" class="btn btn-neutral float-right" title="Joining a network" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright IBM Corporation 2020.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>