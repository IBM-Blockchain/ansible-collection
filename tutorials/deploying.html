<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deploying a smart contract &mdash; Ansible Collection  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Adding an administrator certificate" href="../tasks/addadmincert.html" />
    <link rel="prev" title="Joining a network" href="joining.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Ansible Collection
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrating-v12-v2.html">Migrating from v1.2 to version 2</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="oss-installing.html">Installing Open Source Hyperledger Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="hlfsupport-installing.html">Installing IBM Support for Hyperledger Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing the IBM Blockchain Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building a network</a></li>
<li class="toctree-l1"><a class="reference internal" href="joining.html">Joining a network</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Deploying a smart contract</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#before-you-start">Before you start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deploying-the-smart-contract">Deploying the smart contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exploring-the-network">Exploring the network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exploring-the-playbooks">Exploring the playbooks</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tasks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tasks/addadmincert.html">Adding an administrator certificate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks/enable-fabricv2-capability.html">Enable Hyperledger Fabric v2.x capabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks/haca.html">Creating a highly available Certificate Authority</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks/intermediateCA.html">Creating an Intermediate Certificate Authority</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks/update-channel-parameters.html">Updating channel parameters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roles.html">Roles</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Getting support</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible Collection</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Deploying a smart contract</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/docs/source/tutorials/deploying.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="deploying-a-smart-contract">
<h1>Deploying a smart contract<a class="headerlink" href="#deploying-a-smart-contract" title="Link to this heading"></a></h1>
<p>This tutorial will demonstrate how to use the IBM Blockchain Platform collection for Ansible to automate the process of deploying a smart contract to an existing Hyperledger Fabric network.</p>
<p>In this tutorial, you will use the IBM Blockchain Platform collection for Ansible to deploy the FabCar sample smart contract to an existing Hyperledger Fabric network. The existing Hyperledger Fabric network has three organizations - an ordering organization “Ordering Org”, and two endorsing organizations “Org1” and “Org2”. Both organizations are members of an existing channel called “mychannel”. You will install the FabCar sample smart contract onto the peers for both “Org1” and “Org2”, approve the FabCar smart contract definition on the channel “mychannel” as both organizations, and then commit that smart contract definition.</p>
<p>For this tutorial, you can use the IBM Blockchain Platform on IBM Cloud, or the IBM Blockchain Platform software running in a Red Hat OpenShift or Kubernetes cluster.</p>
<section id="before-you-start">
<h2>Before you start<a class="headerlink" href="#before-you-start" title="Link to this heading"></a></h2>
<p>This tutorial builds upon the Hyperledger Fabric that is created as part of the <a class="reference external" href="./building.html">Building a network</a> and the <a class="reference external" href="./joining.html">Joining a network</a> tutorials. Ensure that you have followed these tutorials, and that you have the network up and running.</p>
<p>You will need to use the GitHub repository that you cloned in the previous tutorial. Ensure that you are in the tutorial directory:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ansible-collection/tutorial
</pre></div>
</div>
</div></blockquote>
</section>
<section id="deploying-the-smart-contract">
<h2>Deploying the smart contract<a class="headerlink" href="#deploying-the-smart-contract" title="Link to this heading"></a></h2>
<p>There are multiple Ansible playbooks used in this tutorial. Each Ansible playbook performs a part of the set of tasks required to deploy the smart contract. Each of the Ansible playbooks is run as one of the endorsing organizations “Org1” or “Org2”.</p>
<p>The contents of these playbooks are explored at the end of this tutorial. For now, a script <a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/deploy_smart_contract.sh">deploy_smart_contract.sh</a> has been provided which runs these Ansible playbooks in order for you.</p>
<p>If you have installed the collection using Ansible Galaxy, or from source, then run the script as follows:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./deploy_smart_contract.sh
</pre></div>
</div>
</div></blockquote>
<p>If you have installed the collection by building a Docker image, then run the script as follows:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker run --rm -u $(id -u) -v &quot;$PWD:/tutorial&quot; ibmcom/ibp-ansible /tutorial/deploy_smart_contract.sh
</pre></div>
</div>
</div></blockquote>
</section>
<section id="exploring-the-network">
<h2>Exploring the network<a class="headerlink" href="#exploring-the-network" title="Link to this heading"></a></h2>
<p>The Ansible playbooks that you just ran installed the FabCar smart contract onto the peers <cite>Org1 Peer</cite> and <cite>Org2 Peer</cite>. The Ansible playbooks also approved the FabCar smart contract definition on the channel <cite>mychannel</cite> as both organizations, and then committed that smart contract definition.</p>
<p>At this point, the FabCar smart contract is deployed and ready for applications to connect to the network and submit transactions. An application that wishes to connect to the network requires two things: an identity and a connection profile. The connection profile is a JSON document that provides the application with a list of endpoints or URLs that the application can use to connect to the network.</p>
<p>The Ansible playbooks registered an application identity for each organization. The organization <cite>Org1</cite> has an application identity named <cite>org1app</cite>, with an enrollment secret of <cite>org1apppw</cite>. The organization <cite>Org2</cite> has an application identity named <cite>org2app</cite>, with an enrollment secret of <cite>org2apppw</cite>. You can use this information to enroll the identity against the respective organizations certificate authority, <cite>Org1 CA</cite> or <cite>Org2 CA</cite>.</p>
<p>The Ansible playbooks created a connection profile for each organization. These connection profiles are created on disk, as JSON files in the same directory as the playbooks. The connection profiles are:</p>
<ul class="simple">
<li><p><cite>Org1 Gateway.json</cite></p></li>
<li><p><cite>Org2 Gateway.json</cite></p></li>
</ul>
<p>An application that uses one of the available Fabric SDKs (Go, Java, or Node.js) can use the identity and connection profile for an organization to connect to the network and submit a transaction. You could also try using the <a class="reference external" href="https://marketplace.visualstudio.com/items?itemName=IBMBlockchain.ibm-blockchain-platform">IBM Blockchain Platform extension for Visual Studio Code</a> to connect to the network and submit a transaction.</p>
</section>
<section id="exploring-the-playbooks">
<h2>Exploring the playbooks<a class="headerlink" href="#exploring-the-playbooks" title="Link to this heading"></a></h2>
<p>When you ran the script <cite>deploy_smart_contract.sh</cite>, you ran multiple Ansible playbooks. Each Ansible playbook performed a different part of deploying the smart contract. This section will explain which organization ran each Ansible playbook, and what each of the playbooks did.</p>
<p>Here are the Ansible playbooks that were executed by the script above:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/19-install-and-approve-chaincode.yml">19-install-and-approve-chaincode.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org1</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 19-install-and-approve-chaincode.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook uses the Ansible module <a class="reference external" href="../modules/installed_chaincode.html">installed_chaincode</a> to install the FabCar smart contract onto the peer <cite>Org1 Peer</cite>, and the Ansible module <cite>approved_chaincode &lt;../modules/approved_chaincode.html&gt;</cite> to approve the FabCar smart contract definition on the channel <cite>mychannel</cite>.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/20-install-and-approve-chaincode.yml">20-install-and-approve-chaincode.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org2</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 20-install-and-approve-chaincode.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook uses the Ansible module <a class="reference external" href="../modules/installed_chaincode.html">installed_chaincode</a> to install the FabCar smart contract onto the peer <cite>Org2 Peer</cite>, and the Ansible module <cite>approved_chaincode &lt;../modules/approved_chaincode.html&gt;</cite> to approve the FabCar smart contract definition on the channel <cite>mychannel</cite>.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/21-commit-chaincode.yml">21-commit-chaincode.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org1</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 21-commit-chaincode.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook uses the Ansible module <a class="reference external" href="../modules/committed_chaincode.html">committed_chaincode</a> to commit the FabCar smart contract definition on the channel <cite>mychannel</cite>.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/22-register-application.yml">22-register-application.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org1</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 22-register-application.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook uses the Ansible module <a class="reference external" href="../modules/registered_identity.html">registered_identity</a> to register a new identity in the certificate authority <cite>Org1 CA</cite>. This playbook also uses the Ansible module <a class="reference external" href="../modules/connection_profile.html">connection_profile</a> to create a connection profile for the organization <cite>Org1</cite>. The identity and the connection profile can be used by the organizations FabCar applications to interact with the network and smart contract.</div>
</div>
</li>
<li><p><a class="reference external" href="https://github.com/IBM-Blockchain/ansible-collection/blob/main/tutorial/23-register-application.yml">23-register-application.yml</a></p>
<div class="line-block">
<div class="line">Organization: Org2</div>
<div class="line">Command:</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook 23-register-application.yml
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">This playbook uses the Ansible module <a class="reference external" href="../modules/registered_identity.html">registered_identity</a> to register a new identity in the certificate authority <cite>Org2 CA</cite>. This playbook also uses the Ansible module <a class="reference external" href="../modules/connection_profile.html">connection_profile</a> to create a connection profile for the organization <cite>Org2</cite>. The identity and the connection profile can be used by the organizations FabCar applications to interact with the network and smart contract.</div>
</div>
</li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="joining.html" class="btn btn-neutral float-left" title="Joining a network" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../tasks/addadmincert.html" class="btn btn-neutral float-right" title="Adding an administrator certificate" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright IBM Corporation 2020.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>